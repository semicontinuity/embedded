#ifndef __KEYPAD_H
#define __KEYPAD_H

#include "cpu/avr/gpio.h"


#define SCANMASK_PRESSED    (1)
#define SCANFLAG_PRESSED    (0)
#define SCANFLAG_RELEASED   (1)

#define COL(col)		((col) << 3)
#define ROW(row)		((row) << 1)

#define KEYEVENT_D_PRESSED      (ROW(0) | COL(0))
#define KEYEVENT_C_PRESSED      (ROW(1) | COL(0))
#define KEYEVENT_B_PRESSED      (ROW(2) | COL(0))
#define KEYEVENT_A_PRESSED      (ROW(3) | COL(0))
#define KEYEVENT_STAR_PRESSED   (ROW(0) | COL(1))
#define KEYEVENT_7_PRESSED      (ROW(1) | COL(1))
#define KEYEVENT_4_PRESSED      (ROW(2) | COL(1))
#define KEYEVENT_1_PRESSED      (ROW(3) | COL(1))
#define KEYEVENT_0_PRESSED      (ROW(0) | COL(2))
#define KEYEVENT_8_PRESSED      (ROW(1) | COL(2))
#define KEYEVENT_5_PRESSED      (ROW(2) | COL(2))
#define KEYEVENT_2_PRESSED      (ROW(3) | COL(2))
#define KEYEVENT_POUND_PRESSED  (ROW(0) | COL(3))
#define KEYEVENT_9_PRESSED      (ROW(1) | COL(3))
#define KEYEVENT_6_PRESSED      (ROW(2) | COL(3))
#define KEYEVENT_3_PRESSED      (ROW(3) | COL(3))

#define KEYEVENT_D_RELEASED     (ROW(0) | COL(0) | SCANFLAG_RELEASED)
#define KEYEVENT_C_RELEASED     (ROW(1) | COL(0) | SCANFLAG_RELEASED)
#define KEYEVENT_B_RELEASED     (ROW(2) | COL(0) | SCANFLAG_RELEASED)
#define KEYEVENT_A_RELEASED     (ROW(3) | COL(0) | SCANFLAG_RELEASED)
#define KEYEVENT_STAR_RELEASED  (ROW(0) | COL(1) | SCANFLAG_RELEASED)
#define KEYEVENT_7_RELEASED     (ROW(1) | COL(1) | SCANFLAG_RELEASED)
#define KEYEVENT_4_RELEASED     (ROW(2) | COL(1) | SCANFLAG_RELEASED)
#define KEYEVENT_1_RELEASED     (ROW(3) | COL(1) | SCANFLAG_RELEASED)
#define KEYEVENT_0_RELEASED     (ROW(0) | COL(2) | SCANFLAG_RELEASED)
#define KEYEVENT_8_RELEASED     (ROW(1) | COL(2) | SCANFLAG_RELEASED)
#define KEYEVENT_5_RELEASED     (ROW(2) | COL(2) | SCANFLAG_RELEASED)
#define KEYEVENT_2_RELEASED     (ROW(3) | COL(2) | SCANFLAG_RELEASED)
#define KEYEVENT_POUND_RELEASED (ROW(0) | COL(3) | SCANFLAG_RELEASED)
#define KEYEVENT_9_RELEASED     (ROW(1) | COL(3) | SCANFLAG_RELEASED)
#define KEYEVENT_6_RELEASED     (ROW(2) | COL(3) | SCANFLAG_RELEASED)
#define KEYEVENT_3_RELEASED     (ROW(3) | COL(3) | SCANFLAG_RELEASED)


#define keypad__init() do {DATA_DIR_REG(CONCAT(KEYPAD,__PORT)) = 0xF0; PORT_REG(CONCAT(KEYPAD,__PORT)) = 0xFF;} while(0)

INLINE void keypad__run(void);

#endif
Adopted from MIOS32 example.
Works on STM32F4 discovery board.

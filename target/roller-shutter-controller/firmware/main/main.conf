# CPU
# Internal RC oscillator
F_CPU                                   = 8000000UL

# Buttons
# All buttons MUST be on the same port
# ==============================================================================
BUTTONS__PORT		                = D
BUTTON1__PORT		                = D
BUTTON1__PIN		                = 7
BUTTON2__PORT		                = D
BUTTON2__PIN		                = 6

# Motor connection
# All motor control signals MUST be on the same, dedicated port
# ==============================================================================
MOTOR__PORT		                = C
MOTOR_UP__PORT		                = C
MOTOR_UP__PIN		                = 0
MOTOR_DOWN__PORT	                = C
MOTOR_DOWN__PIN		                = 1

# Motor controller parameters
# ==============================================================================
# Number of system ticks needed to move the shutter for 1% of its length
MOTOR_CONTROLLER__PRESCALER             = 10
# Dead time (time of motor inactivity for reverse) in % 
MOTOR_CONTROLLER__DEAD_TIME             = 2
# Time in % to account for accumulated positioning error
MOTOR_CONTROLLER__POSITION_ERROR        = 2


# MCP2515 connection and configuration
# ==============================================================================
MCP251X_CS__PORT	                = B
MCP251X_CS__PIN		                = 2

MCP251X__CONF__SYNC_JUMP_WIDTH_BITS     = MCP251X_SYNC_JUMP_WIDTH_1TQ
MCP251X__CONF__BAUD_RATE_PRESCALER_BITS = 7
MCP251X__CONF__BIT_TIME_LENGTH_MODE     = MCP251X_BIT_TIME_LENGTH_MODE_PHSEG
MCP251X__CONF__BUS_SAMPLING_MODE        = MCP251X_BUS_SAMPLING_MODE_X1
MCP251X__CONF__PROP_SEGMENT_1_BITS      = 2
MCP251X__CONF__PROP_SEGMENT_BITS        = 0
MCP251X__CONF__CLKOUT_MODE              = MCP251X_CLKOUT_MODE_CLKOUT_SIGNAL
MCP251X__CONF__WAKEUP_FILTER_MODE       = MCP251X_WAKEUP_FILTER_DISABLED
MCP251X__CONF__PROP_SEGMENT_2_BITS      = 2


# CANP Networking
# ==============================================================================
CANP_DEVICE_TAG                         = 0
CANP_DEVICE_NET                         = 1
CANP_DEVICE_ADDR                        = 1
CANP_MANAGER_NET                        = 1
CANP_MANAGER_ADDR                       = 0

# CANP Reports
# ==============================================================================
CANP_REPORT__MOTOR_CONTROLLER__MOTOR_MODE       = 2
CANP_REPORT__MOTOR_CONTROLLER__CONTROL          = 3
CANP_REPORT__MOTOR_CONTROLLER__STATUS           = 4
CANP_REPORT__BUTTONS_SCANNER__STATUS            = 5

#
# Receive buffers and filters allocation:
#
# - RXB0:
#   - RXF0: DESCRIPTOR_MEMORY (GET)
#   - RXF1: SYSTEM COMMANDS (OWNER=0)
# - RXB1:
#   - RXF2: motor status request (GET).
#   - RXF3: motor controller control requests (GET and PUT).
#   - RXF4: motor controller status request (GET).
#   - RXF5: buttons scanner status request (GET).
#
# Transmit buffers allocation:
#
# - TXB0: Response to current GET request.
# - TXB1: Motor and motor controller notifications (not conflicting).
# - TXB2: Buttons scanner status notifications.
#
# (Set Filter to match All STD frames => will never be triggered)
# ==============================================================================


# RX Buffer 0
# ==============================================================================
CANP_RXM0_TAG                           = CANP_DONT_COMPARE
CANP_RXM0_CPTY_NET                      = CANP_DONT_COMPARE
CANP_RXM0_CPTY_ADDR                     = CANP_DONT_COMPARE
CANP_RXM0_HOST_NET                      = CANP_COMPARE_HOST_NET
CANP_RXM0_HOST_ADDR                     = CANP_COMPARE_HOST_ADDR
CANP_RXM0_OWNER                         = CANP_COMPARE_OWNER
CANP_RXM0_AUX                           = CANP_COMPARE_AUX
CANP_RXM0_REPORT                        = CANP_DONT_COMPARE

CANP_FILTER__DESCRIPTOR_MEMORY          = MCP251X__RX_STATUS__FILTER__0
CANP_RXF0_EXIDE                         = CANP_EXT_ID
CANP_RXF0_TAG                           = CANP_DONT_CARE
CANP_RXF0_CPTY_NET                      = CANP_DONT_CARE
CANP_RXF0_CPTY_ADDR                     = CANP_DONT_CARE
CANP_RXF0_HOST_NET                      = CANP_DEVICE_NET
CANP_RXF0_HOST_ADDR                     = CANP_DEVICE_ADDR
CANP_RXF0_OWNER                         = CANP_OUT
CANP_RXF0_AUX                           = CANP_SYSTEM
CANP_RXF0_REPORT                        = CANP_DONT_CARE

CANP_FILTER__COMMANDS                   = MCP251X__RX_STATUS__FILTER__1
CANP_RXF1_EXIDE                         = CANP_EXT_ID
CANP_RXF1_TAG                           = CANP_DONT_CARE
CANP_RXF1_CPTY_NET                      = CANP_DONT_CARE
CANP_RXF1_CPTY_ADDR                     = CANP_DONT_CARE
CANP_RXF1_HOST_NET                      = CANP_DEVICE_NET
CANP_RXF1_HOST_ADDR                     = CANP_DEVICE_ADDR
CANP_RXF1_OWNER                         = CANP_IN
CANP_RXF1_AUX                           = CANP_SYSTEM
CANP_RXF1_REPORT                        = CANP_DONT_CARE

# RX Buffer 1
# ==============================================================================
CANP_RXM1_TAG                           = CANP_DONT_COMPARE
CANP_RXM1_CPTY_NET                      = CANP_DONT_COMPARE
CANP_RXM1_CPTY_ADDR                     = CANP_DONT_COMPARE
CANP_RXM1_HOST_NET                      = CANP_COMPARE_HOST_NET
CANP_RXM1_HOST_ADDR                     = CANP_COMPARE_HOST_ADDR
CANP_RXM1_OWNER                         = CANP_DONT_COMPARE
CANP_RXM1_AUX                           = CANP_COMPARE_AUX
CANP_RXM1_REPORT                        = CANP_DONT_COMPARE


# RXF2 is dedicated to receive MOTOR_CONTROLLER__MOTOR_MODE reports.
CANP_FILTER__MOTOR_CONTROLLER__MOTOR_MODE = MCP251X__RX_STATUS__FILTER__2
CANP_RXF2_EXIDE                         = CANP_EXT_ID
CANP_RXF2_TAG                           = CANP_DONT_CARE
CANP_RXF2_CPTY_NET                      = CANP_DONT_CARE
CANP_RXF2_CPTY_ADDR                     = CANP_DONT_CARE
CANP_RXF2_HOST_NET                      = CANP_DEVICE_NET
CANP_RXF2_HOST_ADDR                     = CANP_DEVICE_ADDR
CANP_RXF2_OWNER                         = CANP_DONT_CARE
CANP_RXF2_AUX                           = CANP_USER
CANP_RXF2_REPORT                        = CANP_REPORT__MOTOR_CONTROLLER__MOTOR_MODE

# RXF3 is dedicated to receive MOTOR_CONTROLLER__CONTROL reports.
CANP_FILTER__MOTOR_CONTROLLER__CONTROL  = MCP251X__RX_STATUS__FILTER__3
CANP_RXF3_EXIDE                         = CANP_EXT_ID
CANP_RXF3_TAG                           = CANP_DONT_CARE
CANP_RXF3_CPTY_NET                      = CANP_DONT_CARE
CANP_RXF3_CPTY_ADDR                     = CANP_DONT_CARE
CANP_RXF3_HOST_NET                      = CANP_DEVICE_NET
CANP_RXF3_HOST_ADDR                     = CANP_DEVICE_ADDR
CANP_RXF3_OWNER                         = CANP_DONT_CARE
CANP_RXF3_AUX                           = CANP_USER
CANP_RXF3_REPORT                        = CANP_REPORT__MOTOR_CONTROLLER__CONTROL

# RXF4 is dedicated to receive MOTOR_CONTROLLER__STATUS reports.
CANP_FILTER__MOTOR_CONTROLLER__STATUS   = MCP251X__RX_STATUS__FILTER__4
CANP_RXF4_EXIDE                         = CANP_EXT_ID
CANP_RXF4_TAG                           = CANP_DONT_CARE
CANP_RXF4_CPTY_NET                      = CANP_DONT_CARE
CANP_RXF4_CPTY_ADDR                     = CANP_DONT_CARE
CANP_RXF4_HOST_NET                      = CANP_DEVICE_NET
CANP_RXF4_HOST_ADDR                     = CANP_DEVICE_ADDR
CANP_RXF4_OWNER                         = CANP_DONT_CARE
CANP_RXF4_AUX                           = CANP_USER
CANP_RXF4_REPORT                        = CANP_REPORT__MOTOR_CONTROLLER__STATUS

# RXF5 is dedicated to receive BUTTONS_SCANNER__STATUS reports.
CANP_FILTER__BUTTONS_SCANNER__STATUS    = MCP251X__RX_STATUS__FILTER__5
CANP_RXF5_EXIDE                         = CANP_EXT_ID
CANP_RXF5_TAG                           = CANP_DONT_CARE
CANP_RXF5_CPTY_NET                      = CANP_DONT_CARE
CANP_RXF5_CPTY_ADDR                     = CANP_DONT_CARE
CANP_RXF5_HOST_NET                      = CANP_DEVICE_NET
CANP_RXF5_HOST_ADDR                     = CANP_DEVICE_ADDR
CANP_RXF5_OWNER                         = CANP_DONT_CARE
CANP_RXF5_AUX                           = CANP_USER
CANP_RXF5_REPORT                        = CANP_REPORT__BUTTONS_SCANNER__STATUS

# TX Buffer 1
# Used for sending notifications from motor and motor controller.
# Report id and report size are set dynamically.
# ==============================================================================
CANP_TXB1_EXIDE                         = CANP_EXT_ID
CANP_TXB1_TAG                           = CANP_DEVICE_TAG
CANP_TXB1_CPTY_NET                      = CANP_MANAGER_NET
CANP_TXB1_CPTY_ADDR                     = CANP_MANAGER_ADDR
CANP_TXB1_HOST_NET                      = CANP_DEVICE_NET
CANP_TXB1_HOST_ADDR                     = CANP_DEVICE_ADDR
CANP_TXB1_OWNER                         = CANP_OUT
CANP_TXB1_AUX                           = CANP_USER
CANP_TXB1_REPORT_ID                     = 0
CANP_TXB1_REPORT_SIZE                   = 0

# TX Buffer 2
# Used exclusively for sending notifications from buttons.
# Report size is sizeof(buttons_scanner__status) = 2.
# ==============================================================================
CANP_TXB2_EXIDE                         = CANP_EXT_ID
CANP_TXB2_TAG                           = CANP_DEVICE_TAG
CANP_TXB2_CPTY_NET                      = CANP_MANAGER_NET
CANP_TXB2_CPTY_ADDR                     = CANP_MANAGER_ADDR
CANP_TXB2_HOST_NET                      = CANP_DEVICE_NET
CANP_TXB2_HOST_ADDR                     = CANP_DEVICE_ADDR
CANP_TXB2_OWNER                         = CANP_OUT
CANP_TXB2_AUX                           = CANP_USER
CANP_TXB2_REPORT_ID                     = 2
CANP_TXB2_REPORT_SIZE                   = 2
